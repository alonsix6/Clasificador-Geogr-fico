<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clasificador Geogr√°fico de Medios</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect width="40" height="40" rx="10" fill="url(#gradient)"/>
                    <path d="M12 20L18 26L28 14" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                    <defs>
                        <linearGradient id="gradient" x1="0" y1="0" x2="40" y2="40">
                            <stop stop-color="#6366f1"/>
                            <stop offset="1" stop-color="#8b5cf6"/>
                        </linearGradient>
                    </defs>
                </svg>
                <h1>Clasificador Geogr√°fico</h1>
            </div>
            <p class="subtitle">Clasifica tus registros de medios como NACIONAL o por ciudad</p>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Upload Section -->
            <section class="upload-section" id="uploadSection">
                <div class="upload-box" id="uploadBox">
                    <div class="upload-icon">
                        <svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M32 44V20M32 20L24 28M32 20L40 28" stroke="#6366f1" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M12 40V48C12 50.2091 13.7909 52 16 52H48C50.2091 52 52 50.2091 52 48V40" stroke="#6366f1" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <h2>Arrastra tu archivo TXT aqu√≠</h2>
                    <p>Formato: delimitado por pipes (|)</p>
                    <input type="file" id="fileInput" accept=".txt" hidden>
                    <button class="btn btn-primary" id="selectFileBtn">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M3 17H17M10 3V13M10 3L6 7M10 3L14 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Seleccionar archivo
                    </button>
                </div>

                <!-- File Info -->
                <div class="file-info hidden" id="fileInfo">
                    <div class="file-icon">
                        <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M6 4C6 2.89543 6.89543 2 8 2H18L26 10V28C26 29.1046 25.1046 30 24 30H8C6.89543 30 6 29.1046 6 28V4Z" fill="#6366f1"/>
                            <path d="M18 2L26 10H20C18.8954 10 18 9.10457 18 8V2Z" fill="#818cf8"/>
                            <text x="16" y="22" text-anchor="middle" fill="white" font-size="6" font-weight="bold">TXT</text>
                        </svg>
                    </div>
                    <div class="file-details">
                        <span class="file-name" id="fileName">archivo.txt</span>
                        <span class="file-size" id="fileSize">0 KB</span>
                    </div>
                    <button class="btn-icon" id="removeFile" title="Eliminar archivo">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M6 6L14 14M14 6L6 14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                    </button>
                </div>
            </section>

            <!-- Configuraci√≥n de Audiencia Section -->
            <section class="config-section hidden" id="configSection">
                <div class="config-header">
                    <h3>Configuraci√≥n de Audiencia y Ratings</h3>
                    <span class="config-badge">Paso 2</span>
                </div>

                <!-- Carga de archivos RANKINT por zona -->
                <div class="config-group">
                    <label class="config-label">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M4 4C4 2.89543 4.89543 2 6 2H10L14 6V16C14 17.1046 13.1046 18 12 18H6C4.89543 18 4 17.1046 4 16V4Z" stroke="currentColor" stroke-width="1.5"/>
                            <path d="M10 2V6H14" stroke="currentColor" stroke-width="1.5"/>
                        </svg>
                        Archivos RANKINT (Excel con ratings - uno o varios por zona)
                    </label>
                    <p class="config-hint">Puedes subir un archivo por ciudad o un archivo combinado por zona</p>

                    <div class="rankint-zones">
                        <!-- Zona Norte -->
                        <div class="rankint-zone norte">
                            <div class="zone-header">
                                <span class="zone-title">NORTE</span>
                                <span class="zone-cities">Chiclayo, Trujillo, Piura</span>
                            </div>
                            <div class="zone-files" id="norteFilesList"></div>
                            <div class="zone-upload">
                                <input type="file" id="rankintNorteInput" accept=".xlsx,.xls" multiple hidden>
                                <button class="btn btn-outline btn-sm" id="selectRankintNorteBtn">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                        <path d="M8 3V13M3 8H13" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                    </svg>
                                    Agregar Excel(s)
                                </button>
                            </div>
                        </div>

                        <!-- Zona Sur -->
                        <div class="rankint-zone sur">
                            <div class="zone-header">
                                <span class="zone-title">SUR</span>
                                <span class="zone-cities">Arequipa, Cusco, Huancayo</span>
                            </div>
                            <div class="zone-files" id="surFilesList"></div>
                            <div class="zone-upload">
                                <input type="file" id="rankintSurInput" accept=".xlsx,.xls" multiple hidden>
                                <button class="btn btn-outline btn-sm" id="selectRankintSurBtn">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                        <path d="M8 3V13M3 8H13" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                    </svg>
                                    Agregar Excel(s)
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="rankint-summary hidden" id="rankintSummary">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <path d="M13.5 4.5L6 12L2.5 8.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span id="rankintSummaryText">0 archivos cargados</span>
                    </div>
                </div>

                <!-- Selector de √Åmbito -->
                <div class="config-group">
                    <label class="config-label">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="10" cy="10" r="7" stroke="currentColor" stroke-width="1.5"/>
                            <path d="M10 3C10 3 7 6.5 7 10C7 13.5 10 17 10 17M10 3C10 3 13 6.5 13 10C13 13.5 10 17 10 17M3 10H17" stroke="currentColor" stroke-width="1.5"/>
                        </svg>
                        Seleccionar √Åmbito Geogr√°fico
                    </label>
                    <div class="ambito-selector">
                        <label class="radio-card">
                            <input type="radio" name="ambito" value="nacional" id="ambitoNacional">
                            <span class="radio-card-content">
                                <span class="radio-icon">üáµüá™</span>
                                <span class="radio-label">NACIONAL</span>
                                <span class="radio-desc">Todo el pa√≠s</span>
                            </span>
                        </label>
                        <label class="radio-card">
                            <input type="radio" name="ambito" value="regiones" id="ambitoRegiones" checked>
                            <span class="radio-card-content">
                                <span class="radio-icon">üó∫Ô∏è</span>
                                <span class="radio-label">REGIONES</span>
                                <span class="radio-desc">Norte y Sur</span>
                            </span>
                        </label>
                        <label class="radio-card">
                            <input type="radio" name="ambito" value="lima" id="ambitoLima">
                            <span class="radio-card-content">
                                <span class="radio-icon">üèôÔ∏è</span>
                                <span class="radio-label">LIMA</span>
                                <span class="radio-desc">Solo Lima</span>
                            </span>
                        </label>
                    </div>
                </div>

                <!-- Campos de Audiencia (solo visible para REGIONES) -->
                <div class="config-group audiencia-group" id="audienciaGroup">
                    <label class="config-label">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M13 7C13 8.65685 11.6569 10 10 10C8.34315 10 7 8.65685 7 7C7 5.34315 8.34315 4 10 4C11.6569 4 13 5.34315 13 7Z" stroke="currentColor" stroke-width="1.5"/>
                            <path d="M10 13C6.13401 13 3 14.7909 3 17H17C17 14.7909 13.866 13 10 13Z" stroke="currentColor" stroke-width="1.5"/>
                        </svg>
                        Audiencia en Miles (ej: 209 = 209,000 personas)
                    </label>
                    <div class="audiencia-inputs">
                        <div class="audiencia-card norte">
                            <div class="audiencia-header">
                                <span class="audiencia-region">NORTE</span>
                                <span class="audiencia-cities">Chiclayo, Trujillo, Piura</span>
                            </div>
                            <div class="input-with-suffix">
                                <input type="number" id="audienciaNorte" placeholder="209" min="0" step="0.001">
                                <span class="suffix">,000</span>
                            </div>
                        </div>
                        <div class="audiencia-card sur">
                            <div class="audiencia-header">
                                <span class="audiencia-region">SUR</span>
                                <span class="audiencia-cities">Arequipa, Cusco, Huancayo</span>
                            </div>
                            <div class="input-with-suffix">
                                <input type="number" id="audienciaSur" placeholder="156" min="0" step="0.001">
                                <span class="suffix">,000</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Porcentajes por Ciudad -->
                <div class="config-group porcentajes-group" id="porcentajesGroup">
                    <label class="config-label">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="10" cy="10" r="7" stroke="currentColor" stroke-width="1.5"/>
                            <path d="M10 6V10L13 12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                        </svg>
                        Distribuci√≥n Porcentual por Ciudad
                    </label>
                    <div class="porcentajes-container">
                        <div class="porcentaje-region norte">
                            <div class="porcentaje-header">
                                <span>NORTE</span>
                                <span class="porcentaje-total" id="totalNorte">0%</span>
                            </div>
                            <div class="porcentaje-inputs">
                                <div class="porcentaje-item">
                                    <label>Chiclayo</label>
                                    <div class="input-with-suffix small">
                                        <input type="number" id="pctChiclayo" value="33.33" min="0" max="100" step="0.01">
                                        <span class="suffix">%</span>
                                    </div>
                                </div>
                                <div class="porcentaje-item">
                                    <label>Trujillo</label>
                                    <div class="input-with-suffix small">
                                        <input type="number" id="pctTrujillo" value="33.33" min="0" max="100" step="0.01">
                                        <span class="suffix">%</span>
                                    </div>
                                </div>
                                <div class="porcentaje-item">
                                    <label>Piura</label>
                                    <div class="input-with-suffix small">
                                        <input type="number" id="pctPiura" value="33.34" min="0" max="100" step="0.01">
                                        <span class="suffix">%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="porcentaje-region sur">
                            <div class="porcentaje-header">
                                <span>SUR</span>
                                <span class="porcentaje-total" id="totalSur">0%</span>
                            </div>
                            <div class="porcentaje-inputs">
                                <div class="porcentaje-item">
                                    <label>Arequipa</label>
                                    <div class="input-with-suffix small">
                                        <input type="number" id="pctArequipa" value="33.33" min="0" max="100" step="0.01">
                                        <span class="suffix">%</span>
                                    </div>
                                </div>
                                <div class="porcentaje-item">
                                    <label>Cusco</label>
                                    <div class="input-with-suffix small">
                                        <input type="number" id="pctCusco" value="33.33" min="0" max="100" step="0.01">
                                        <span class="suffix">%</span>
                                    </div>
                                </div>
                                <div class="porcentaje-item">
                                    <label>Huancayo</label>
                                    <div class="input-with-suffix small">
                                        <input type="number" id="pctHuancayo" value="33.34" min="0" max="100" step="0.01">
                                        <span class="suffix">%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="porcentaje-warning hidden" id="porcentajeWarning">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M8 5V8M8 11H8.01M14 8A6 6 0 112 8a6 6 0 0112 0Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                        </svg>
                        <span>Los porcentajes de cada regi√≥n deben sumar 100%</span>
                    </div>
                </div>
            </section>

            <!-- Preview Section -->
            <section class="preview-section hidden" id="previewSection">
                <div class="preview-header">
                    <h3>Previsualizaci√≥n de datos</h3>
                    <span class="preview-count" id="previewCount">0 registros</span>
                </div>
                <div class="preview-info">
                    <div class="info-badge">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M8 14A6 6 0 108 2a6 6 0 000 12zM8 5v3M8 11h.01" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                        </svg>
                        <span>Emisoras NACIONAL autom√°tico: <strong>ATV+, NATIVA TV, RPP TV, WILLAX PERU</strong></span>
                    </div>
                </div>
                <div class="table-container">
                    <table class="preview-table" id="previewTable">
                        <thead id="previewHead"></thead>
                        <tbody id="previewBody"></tbody>
                    </table>
                </div>
                <div class="preview-actions">
                    <button class="btn btn-secondary" id="cancelBtn">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M6 6L14 14M14 6L6 14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        Cancelar
                    </button>
                    <button class="btn btn-primary btn-large" id="processBtn">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M9 12L11 14L15 10M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Procesar y clasificar
                    </button>
                </div>
            </section>

            <!-- Progress Section -->
            <section class="progress-section hidden" id="progressSection">
                <div class="progress-content">
                    <div class="spinner"></div>
                    <h3>Procesando archivo...</h3>
                    <p id="progressText">Analizando registros</p>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                </div>
            </section>

            <!-- Results Section -->
            <section class="results-section hidden" id="resultsSection">
                <div class="results-header">
                    <h3>Resultados de la clasificaci√≥n</h3>
                    <button class="btn btn-secondary" id="newFileBtn">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M10 4V16M4 10H16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        Nuevo archivo
                    </button>
                </div>

                <!-- Stats Cards -->
                <div class="stats-grid">
                    <div class="stat-card stat-total">
                        <div class="stat-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M9 5H7C5.89543 5 5 5.89543 5 7V19C5 20.1046 5.89543 21 7 21H17C18.1046 21 19 20.1046 19 19V7C19 5.89543 18.1046 5 17 5H15M9 5C9 6.10457 9.89543 7 11 7H13C14.1046 7 15 6.10457 15 5M9 5C9 3.89543 9.89543 3 11 3H13C14.1046 3 15 3.89543 15 5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="totalRecords">0</span>
                            <span class="stat-label">Total registros</span>
                        </div>
                    </div>
                    <div class="stat-card stat-national">
                        <div class="stat-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2"/>
                                <path d="M12 3C12 3 8 8 8 12C8 16 12 21 12 21M12 3C12 3 16 8 16 12C16 16 12 21 12 21M3 12H21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="nationalRecords">0</span>
                            <span class="stat-label">NACIONAL</span>
                        </div>
                    </div>
                    <div class="stat-card stat-groups">
                        <div class="stat-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M17 21V19C17 16.7909 15.2091 15 13 15H5C2.79086 15 1 16.7909 1 19V21M23 21V19C23 17.1362 21.7252 15.5701 20 15.126M16 3.12602C17.7252 3.57006 19 5.13623 19 7C19 8.86377 17.7252 10.4299 16 10.874M13 7C13 9.20914 11.2091 11 9 11C6.79086 11 5 9.20914 5 7C5 4.79086 6.79086 3 9 3C11.2091 3 13 4.79086 13 7Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="totalGroups">0</span>
                            <span class="stat-label">Grupos √∫nicos</span>
                        </div>
                    </div>
                    <div class="stat-card stat-national-groups">
                        <div class="stat-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M9 12L11 14L15 10M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="nationalGroups">0</span>
                            <span class="stat-label">Grupos NACIONAL</span>
                        </div>
                    </div>
                </div>

                <!-- Distribution Chart -->
                <div class="distribution-card">
                    <h4>Distribuci√≥n por clasificaci√≥n</h4>
                    <div class="distribution-chart" id="distributionChart"></div>
                </div>

                <!-- Download Button -->
                <button class="btn btn-success btn-large" id="downloadBtn">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M10 3V13M10 13L6 9M10 13L14 9M3 17H17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Descargar Excel clasificado
                </button>
            </section>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p>Clasificaci√≥n geogr√°fica de registros de medios</p>
            <p class="footer-note">Las 7 ciudades para NACIONAL: Lima, Arequipa, Trujillo, Cusco, Chiclayo, Huancayo, Piura</p>
        </footer>
    </div>

    <!-- SheetJS Library -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
